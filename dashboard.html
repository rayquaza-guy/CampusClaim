<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CampusClaim â€” Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/navbar.css">
<link rel="stylesheet" href="css/components.css">
<link rel="stylesheet" href="css/util.css">
<link rel="stylesheet" href="css/dashboard.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav class="topbar">
    <div class="brand">CampusClaim</div>
    <div class="nav-actions">
      <span id="userEmail" class="linkbtn"></span>
      <button id="logoutBtn" class="primary">Logout</button>
    </div>
  </nav>

<main class="dashboard">

  <section class="dash-header">
    <h1>Welcome back ðŸ‘‹</h1>
    <p>Your campus lost & found portal.</p>
  </section>

  <section class="dash-actions">
    <div class="dash-card">
      <h2>Browse Inventory</h2>
      <p>Search through all items registered by the admin office.</p>
      <a href="inventory.html">
         <button class="primary">Browse</button>
       </a>
    </div>

    <div class="dash-card">
      <h2>Your Claims</h2>
      <p>Track the status of claims you've submitted.</p>
      <a href="claim-status.html" class="dash-btn">View Claims</a>
    </div>
  </section>

  <section class="dash-stats">
    <h3>Quick Info</h3>
    <div id="quickStats" class="stats-box">Loading...</div>
  </section>

</main>


  <script src="firebase.js"></script>
  <script>
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged(user=>{
      if (!user || !user.email || !user.email.endsWith('@thapar.edu')) {
        location.href='index.html'; return;
      }
      document.getElementById('userEmail').textContent = user.email;
      loadStats();
    });

    document.getElementById('logoutBtn').addEventListener('click', async ()=>{
      await auth.signOut();
      location.href='index.html';
    });

    async function loadStats(){
      const snap = await db.collection('items').get();
      const total = snap.size;
      const snapClaims = await db.collection('claims').where('claimantEmail','==', (firebase.auth().currentUser && firebase.auth().currentUser.email) || '').get();
      const myClaims = snapClaims.size;
      document.getElementById('quickStats').innerText = `Items in registry: ${total} â€¢ Your claims: ${myClaims}`;
    }
  </script>
</body>
</html>
